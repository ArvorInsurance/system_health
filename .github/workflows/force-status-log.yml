name: Force Status Log
on:
  schedule:
    - cron: "*/5 * * * *"  # æ¯5åˆ†é˜é‹è¡Œä¸€æ¬¡
  workflow_dispatch:

jobs:
  force-log:
    name: Force Status Log
    runs-on: ubuntu-latest
    permissions:
      contents: write
      issues: write
      pull-requests: write
      actions: write
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GH_PAT || github.token }}
      
      - name: Check endpoints and force log
        run: |
          echo "ğŸ”„ Force checking endpoints and logging status..."
          
          # Get current timestamp
          TIMESTAMP=$(date -u +"%Y-%m-%dT%H:%M:%S.000Z")
          
          # Check each endpoint and log status
          echo "ğŸ“Š Checking endpoints at $TIMESTAMP"
          
          # Company Research Website
          echo "ğŸŒ Checking Company Research Website..."
          if curl -s -o /dev/null -w "%{http_code} %{time_total}" "https://company-research.apps.arvorinsurance.com/" | grep -q "200"; then
            echo "âœ… Company Research Website is up"
            echo "ğŸŸ© Company Research Website is up (200 in $(curl -s -o /dev/null -w "%{time_total}" "https://company-research.apps.arvorinsurance.com/")s) [skip ci] [upptime]" >> force-status.log
          else
            echo "âŒ Company Research Website is down"
            echo "ğŸ”´ Company Research Website is down [skip ci] [upptime]" >> force-status.log
          fi
          
          # Company Research Health
          echo "ğŸ¥ Checking Company Research Health..."
          if curl -s -o /dev/null -w "%{http_code} %{time_total}" "https://company-research.apps.arvorinsurance.com/api/health" | grep -q "200"; then
            echo "âœ… Company Research Health is up"
            echo "ğŸŸ© Company Research Health is up (200 in $(curl -s -o /dev/null -w "%{time_total}" "https://company-research.apps.arvorinsurance.com/api/health")s) [skip ci] [upptime]" >> force-status.log
          else
            echo "âŒ Company Research Health is down"
            echo "ğŸ”´ Company Research Health is down [skip ci] [upptime]" >> force-status.log
          fi
          
          # Company Research Auth
          echo "ğŸ” Checking Company Research Auth..."
          if curl -s -o /dev/null -w "%{http_code} %{time_total}" "https://company-research.apps.arvorinsurance.com/api/auth/verify" | grep -q "200"; then
            echo "âœ… Company Research Auth is up"
            echo "ğŸŸ© Company Research Auth is up (200 in $(curl -s -o /dev/null -w "%{time_total}" "https://company-research.apps.arvorinsurance.com/api/auth/verify")s) [skip ci] [upptime]" >> force-status.log
          else
            echo "âŒ Company Research Auth is down"
            echo "ğŸ”´ Company Research Auth is down [skip ci] [upptime]" >> force-status.log
          fi
          
          # Company Research Core API
          echo "ğŸ”Œ Checking Company Research Core API..."
          if curl -s -o /dev/null -w "%{http_code} %{time_total}" "https://company-research.apps.arvorinsurance.com/api/advice/research" | grep -q "200"; then
            echo "âœ… Company Research Core API is up"
            echo "ğŸŸ© Company Research Core API is up (200 in $(curl -s -o /dev/null -w "%{time_total}" "https://company-research.apps.arvorinsurance.com/api/advice/research")s) [skip ci] [upptime]" >> force-status.log
          else
            echo "âŒ Company Research Core API is down"
            echo "ğŸ”´ Company Research Core API is down [skip ci] [upptime]" >> force-status.log
          fi
          
          echo "ğŸ“ Status logged to force-status.log"
      
      - name: Commit and push status log
        run: |
          if [ -f force-status.log ]; then
            echo "ğŸ“¤ Committing and pushing status log..."
            
            # Configure git
            git config --local user.email "upptime-bot@users.noreply.github.com"
            git config --local user.name "Upptime Bot"
            
            # Add and commit the log file
            git add force-status.log
            git commit -m "ğŸ“Š Force status log update [skip ci] [upptime]"
            
            # Push to repository
            git push origin HEAD:master
          else
            echo "âš ï¸ No status log file found"
          fi
        env:
          GH_PAT: ${{ secrets.GH_PAT || github.token }}
